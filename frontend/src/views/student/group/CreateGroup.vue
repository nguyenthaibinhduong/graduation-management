<template>
    <div class="w-full mx-auto mt-3 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-md text-blue-900 shadow-sm">
        <h3 class="text-lg font-semibold mb-2">ğŸ“ HÆ°á»›ng dáº«n sá»­ dá»¥ng chá»©c nÄƒng Ä‘Äƒng kÃ½ nhÃ³m</h3>

        <ul class="list-inside text-sm space-y-2">
            <template v-if="!showMore">
                <!-- RÃºt gá»n: chá»‰ hiá»ƒn thá»‹ 3 pháº§n Ä‘áº§u -->
                <li><strong>1.Táº¡o nhÃ³m má»›i</strong></li>
                <ul class="list-inside space-y-1">
                    <li><strong>ÄÄƒng kÃ½ 1 mÃ¬nh:</strong> Báº¡n cÃ³ thá»ƒ táº¡o nhÃ³m cho riÃªng mÃ¬nh. NhÃ³m sáº½ cÃ³ tráº¡ng thÃ¡i <span
                            class="font-bold">Pending</span> (chá» duyá»‡t). Há»‡ thá»‘ng sáº½ táº¡o mÃ£ nhÃ³m duy nháº¥t cho báº¡n.</li>
                    <li><strong>Má»i thÃªm thÃ nh viÃªn vÃ o nhÃ³m:</strong> Báº¡n cÃ³ thá»ƒ má»i cÃ¡c sinh viÃªn khÃ¡c tham gia nhÃ³m.
                        NhÃ³m
                        sáº½ cÃ³ tráº¡ng thÃ¡i <span class="font-bold">Create</span> (Ä‘ang táº¡o), vÃ  cÃ¡c thÃ nh viÃªn báº¡n má»i sáº½
                        nháº­n
                        lá»i má»i tham gia nhÃ³m.</li>
                </ul>

                <li><strong>2.Cháº¥p nháº­n hoáº·c tá»« chá»‘i lá»i má»i</strong></li>
                <ul class="list-inside space-y-1">
                    <li><strong>Cháº¥p nháº­n lá»i má»i:</strong> Khi sinh viÃªn Ä‘Æ°á»£c má»i cháº¥p nháº­n lá»i má»i, nhÃ³m sáº½ chuyá»ƒn
                        sang
                        tráº¡ng thÃ¡i <span class="font-bold">Pending</span> (chá» duyá»‡t). CÃ¡c thÃ nh viÃªn sáº½ chá» giÃ¡o vá»¥
                        duyá»‡t
                        nhÃ³m.</li>
                    <li><strong>Tá»« chá»‘i lá»i má»i:</strong> Náº¿u má»™t thÃ nh viÃªn tá»« chá»‘i lá»i má»i, nhÃ³m sáº½ cáº­p nháº­t sang
                        tráº¡ng
                        thÃ¡i nhÃ³m 1 thÃ nh viÃªn</li>
                </ul>
            </template>
            <template v-else>
                <li><strong>1.Táº¡o nhÃ³m má»›i</strong></li>
                <ul class="list-inside space-y-1">
                    <li><strong>ÄÄƒng kÃ½ 1 mÃ¬nh:</strong> Báº¡n cÃ³ thá»ƒ táº¡o nhÃ³m cho riÃªng mÃ¬nh. NhÃ³m sáº½ cÃ³ tráº¡ng thÃ¡i <span
                            class="font-bold">Pending</span> (chá» duyá»‡t). Há»‡ thá»‘ng sáº½ táº¡o mÃ£ nhÃ³m duy nháº¥t cho báº¡n.</li>
                    <li><strong>Má»i thÃªm thÃ nh viÃªn vÃ o nhÃ³m:</strong> Báº¡n cÃ³ thá»ƒ má»i cÃ¡c sinh viÃªn khÃ¡c tham gia nhÃ³m.
                        NhÃ³m
                        sáº½ cÃ³ tráº¡ng thÃ¡i <span class="font-bold">Create</span> (Ä‘ang táº¡o), vÃ  cÃ¡c thÃ nh viÃªn báº¡n má»i sáº½
                        nháº­n
                        lá»i má»i tham gia nhÃ³m.</li>
                </ul>

                <li><strong>2.Cháº¥p nháº­n hoáº·c tá»« chá»‘i lá»i má»i</strong></li>
                <ul class="list-inside space-y-1">
                    <li><strong>Cháº¥p nháº­n lá»i má»i:</strong> Khi sinh viÃªn Ä‘Æ°á»£c má»i cháº¥p nháº­n lá»i má»i, nhÃ³m sáº½ chuyá»ƒn
                        sang
                        tráº¡ng thÃ¡i <span class="font-bold">Pending</span> (chá» duyá»‡t). CÃ¡c thÃ nh viÃªn sáº½ chá» giÃ¡o vá»¥
                        duyá»‡t
                        nhÃ³m.</li>
                    <li><strong>Tá»« chá»‘i lá»i má»i:</strong> Náº¿u má»™t thÃ nh viÃªn tá»« chá»‘i lá»i má»i, nhÃ³m sáº½ cáº­p nháº­t sang
                        tráº¡ng
                        thÃ¡i nhÃ³m 1 thÃ nh viÃªn</li>
                </ul>

                <li><strong>3.KhÃ³a nhÃ³m vÃ  duyá»‡t nhÃ³m</strong></li>
                <ul class="list-inside space-y-1">
                    <li>Khi Ä‘áº¿n Ä‘á»£t khÃ³a nhÃ³m, cÃ¡c nhÃ³m cÃ³ tráº¡ng thÃ¡i <span class="font-bold">Pending</span> sáº½ tá»± Ä‘á»™ng
                        chuyá»ƒn thÃ nh <span class="font-bold">Approved</span> (Ä‘Ã£ duyá»‡t).</li>
                    <li>Chá»‰ khi nhÃ³m cÃ³ tráº¡ng thÃ¡i <span class="font-bold">Approved</span>, báº¡n má»›i cÃ³ thá»ƒ Ä‘Äƒng kÃ½ Ä‘á»
                        tÃ i
                        cho nhÃ³m.</li>
                </ul>

                <li><strong>4.Má»i thÃªm thÃ nh viÃªn</strong></li>
                <ul class="list-inside space-y-1">
                    <li>Sau khi nhÃ³m Ä‘Ã£ cÃ³ Ã­t nháº¥t má»™t thÃ nh viÃªn, báº¡n cÃ³ thá»ƒ má»i thÃªm thÃ nh viÃªn vÃ o nhÃ³m.</li>
                    <li>Há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng cáº­p nháº­t láº¡i tráº¡ng thÃ¡i cá»§a nhÃ³m vÃ  sá»‘ lÆ°á»£ng thÃ nh viÃªn.</li>
                </ul>

                <li><strong>5.Táº¡o nhÃ³m má»›i sau khi há»§y nhÃ³m cÅ©</strong></li>
                <ul class="list-inside space-y-1">
                    <li>Náº¿u nhÃ³m hiá»‡n táº¡i cá»§a báº¡n cÃ³ tráº¡ng thÃ¡i khÃ¡c <span class="font-bold">Approved</span> (chÆ°a
                        duyá»‡t),
                        báº¡n cáº§n há»§y nhÃ³m cÅ© Ä‘á»ƒ táº¡o nhÃ³m má»›i.</li>
                    <li>Há»‡ thá»‘ng khÃ´ng cho phÃ©p táº¡o nhÃ³m má»›i náº¿u nhÃ³m cÅ© chÆ°a Ä‘Æ°á»£c duyá»‡t (status != <span
                            class="font-bold">Approved</span>).</li>
                </ul>

                <li><strong>6.TrÆ°á»ng há»£p nhÃ³m Ä‘Ã£ khÃ³a</strong></li>
                <ul class="list-inside space-y-1">
                    <li>Trong trÆ°á»ng há»£p nhÃ³m Ä‘Ã£ cÃ³ tráº¡ng thÃ¡i <span class="font-bold">Approved</span> vÃ  báº¡n muá»‘n má»i
                        thÃªm
                        thÃ nh viÃªn má»›i, báº¡n cáº§n táº¡o yÃªu cáº§u Ä‘Äƒng kÃ½ nhÃ³m má»›i.</li>
                    <li>YÃªu cáº§u sáº½ Ä‘Æ°á»£c gá»­i cho giÃ¡o vá»¥ duyá»‡t nhÃ³m má»›i.</li>
                </ul>
            </template>
        </ul>

        <h4 class="text-md font-semibold mt-4">âš ï¸ LÆ°u Ã½ quan trá»ng:</h4>
        <ul class="list-disc list-inside text-sm">
            <li><strong>Chá»‰ sinh viÃªn thuá»™c cÃ¹ng khoa má»›i cÃ³ thá»ƒ tham gia nhÃ³m.</strong></li>
            <li><strong>TrÆ°á»Ÿng nhÃ³m nhÃ³m khÃ¡c khÃ´ng thá»ƒ táº¡o nhÃ³m má»›i, cáº§n há»§y nhÃ³m cÅ©.</strong></li>
            <li><strong>NhÃ³m Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t thÃ¬ khÃ´ng thá»ƒ thay Ä‘á»•i thÃ nh viÃªn.</strong></li>
        </ul>

        <!-- NÃºt Toggle -->
        <button @click="showMore = !showMore" class="mt-3 text-sm text-blue-600 underline hover:text-blue-800 ">
            {{ showMore ? 'Thu gá»n' : 'Xem thÃªm ' }}
        </button>
    </div>

    <div class="w-full grid grid-cols-2 gap-x-4">
        <div class="w-full mt-10 mx-auto o p-6 bg-white  rounded-xl shadow-sm">
            <h2 class="text-2xl font-semibold mb-4">ÄÄƒng kÃ½ nhÃ³m khÃ³a luáº­n</h2>

            <!-- TÃªn nhÃ³m -->
            <div class="mb-4">
                <label for="group_name" class="block mb-1 font-medium">TÃªn nhÃ³m</label>
                <MyInput type="text" id="group_name" v-model="group_name" class="w-full" placeholder="Nháº­p tÃªn nhÃ³m" />
            </div>

            <!-- Má»i thÃ nh viÃªn -->
            <div class="mb-4 ">
                <label for="student_code" class="block mb-1 font-medium">MÃ£ sinh viÃªn (thÃ nh viÃªn)</label>
                <MyInput type="text" id="student_code" v-model="student_code" class="w-full"
                    placeholder="MÃ£ sinh viÃªn muá»‘n má»i (tá»‘i Ä‘a 1 sinh viÃªn)" />
            </div>

            <!-- Gá»­i lá»i má»i -->
            <div class="flex justify-end space-x-2">
                <Button label="Táº¡o nhÃ³m" icon="pi pi-users" @click="createGroup" />
                <Button label="Gá»­i lá»i má»i" icon="pi pi-send" class="p-button-success" @click="inviteMember" />
            </div>

            <!-- ThÃ´ng bÃ¡o -->

        </div>
        <div class="w-full mt-10 p-6 bg-white rounded-xl shadow-sm ">
            <h2 class="text-2xl font-semibold mb-4 text-green-700">ThÃ´ng tin nhÃ³m cá»§a báº¡n</h2>
            <div v-if="group?.length < 1 || !group" class="text-gray-500 text-sm">
                Báº¡n hiá»‡n chÆ°a cÃ³ nhÃ³m Ä‘Äƒng kÃ½
            </div>
            <div v-else class="space-y-2 text-base">
                <div><span class="font-medium">TÃªn nhÃ³m:</span> {{ group?.name }}</div>
                <div><span class="font-medium">MÃ£ nhÃ³m:</span> {{ group?.code }}</div>
                <div><span class="font-medium">TrÆ°á»Ÿng nhÃ³m:</span> {{ group?.leader?.user?.fullname }} </div>
                <div>
                    <span class="font-medium">ThÃ nh viÃªn:</span>
                    <ul class="list-disc list-inside ml-2">
                        <li v-for="member in (group?.status == 'approve' ? group?.students : group?.student_attemp)"
                            :key="member.id">
                            {{ member.user?.fullname }} ({{ member.code }})
                        </li>
                    </ul>
                </div>
                <div><span class="font-medium">Tráº¡ng thÃ¡i:</span> <span class="text-blue-600">{{ group?.status }}</span>
                </div>
            </div>
        </div>
    </div>

</template>

<script setup>
import { onMounted, ref, watchEffect } from 'vue'

import Button from 'primevue/button'
import MyInput from '@/components/form/MyInput.vue'
import { useAuthStore } from '@/stores/auth'
import { useGroupStore } from '@/stores/store'
import { showToast } from '@/utils/toast'

const group_name = ref('')
const student_code = ref('')
const message = ref('')
const authStore = useAuthStore();
const student = ref()
const group = ref(null)
const groupStore = useGroupStore()
const showMore = ref(false)
onMounted(async () => {
    await authStore.fetchUser();
    await groupStore.getMyGroup()


})
watchEffect(() => {
    student.value = authStore.user?.student
    group.value = groupStore.group
})
// HÃ m táº¡o nhÃ³m (logic báº¡n tá»± thÃªm)
const createGroup = async () => {
    if (!group_name?.value) {
        showToast('ChÆ°a Ä‘iá»n tÃªn nhÃ³m', 'info')
    } else {
        if (!student_code?.value) {
            const param = {
                name: group_name.value,
                student_codes: [student.value?.code],
            }
            await groupStore.addItem(param)
            await groupStore.getMyGroup()
            console.log(group.value);

            group_name.value = ''
            student_code.value = ''
        } else {
            await inviteMember();
        }

    }

}

const inviteMember = async () => {
    if (!student_code?.value) {
        showToast('ChÆ°a Ä‘iá»n mÃ£ sinh viÃªn thÃ nh viÃªn', 'info')
    } else {
        const param = {
            name: group_name.value,
            student_codes: [student.value?.code, student_code?.value],
        }

        await groupStore.addItem(param)
        await groupStore.getMyGroup()
        console.log(group.value);

        group_name.value = ''
        student_code.value = ''
    }

}



// HÃ m gá»­i lá»i má»i (logic báº¡n tá»± thÃªm)
const sendInvite = () => {
    console.log('Gá»­i lá»i má»i Ä‘áº¿n:', memberEmail.value)
    message.value = 'ÄÃ£ gá»­i lá»i má»i Ä‘áº¿n sinh viÃªn (giáº£ láº­p).'
    // TODO: Gá»­i lá»i má»i Ä‘áº¿n email thÃ´ng qua API
}
</script>

<style scoped>
/* ThÃªm náº¿u cáº§n style riÃªng */
</style>
